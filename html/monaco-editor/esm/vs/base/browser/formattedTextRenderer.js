import*as DOM from"./dom.js";export function renderText(e,t={}){const n=createElement(t);return n.textContent=e,n}export function renderFormattedText(e,t={}){const n=createElement(t);return _renderFormattedText(n,parseFormattedText(e,!!t.renderCodeSegments),t.actionHandler,t.renderCodeSegments),n}export function createElement(e){const t=e.inline?"span":"div",n=document.createElement(t);return e.className&&(n.className=e.className),n}class StringStream{constructor(e){this.source=e,this.index=0}eos(){return this.index>=this.source.length}next(){const e=this.peek();return this.advance(),e}peek(){return this.source[this.index]}advance(){this.index++}}function _renderFormattedText(e,t,n,r){let c;if(2===t.type)c=document.createTextNode(t.content||"");else if(3===t.type)c=document.createElement("b");else if(4===t.type)c=document.createElement("i");else if(7===t.type&&r)c=document.createElement("code");else if(5===t.type&&n){const e=document.createElement("a");n.disposables.add(DOM.addStandardDisposableListener(e,"click",(e=>{n.callback(String(t.index),e)}))),c=e}else 8===t.type?c=document.createElement("br"):1===t.type&&(c=e);c&&e!==c&&e.appendChild(c),c&&Array.isArray(t.children)&&t.children.forEach((e=>{_renderFormattedText(c,e,n,r)}))}function parseFormattedText(e,t){const n={type:1,children:[]};let r=0,c=n;const s=[],a=new StringStream(e);while(!a.eos()){let e=a.next();const n="\\"===e&&0!==formatTagType(a.peek(),t);if(n&&(e=a.next()),!n&&isFormatTag(e,t)&&e===a.peek()){a.advance(),2===c.type&&(c=s.pop());const n=formatTagType(e,t);if(c.type===n||5===c.type&&6===n)c=s.pop();else{const e={type:n,children:[]};5===n&&(e.index=r,r++),c.children.push(e),s.push(c),c=e}}else if("\n"===e)2===c.type&&(c=s.pop()),c.children.push({type:8});else if(2!==c.type){const t={type:2,content:e};c.children.push(t),s.push(c),c=t}else c.content+=e}return 2===c.type&&(c=s.pop()),s.length,n}function isFormatTag(e,t){return 0!==formatTagType(e,t)}function formatTagType(e,t){switch(e){case"*":return 3;case"_":return 4;case"[":return 5;case"]":return 6;case"`":return t?7:0;default:return 0}}