import*as browser from"./browser.js";import{EVENT_KEY_CODE_MAP,KeyCodeUtils}from"../common/keyCodes.js";import{SimpleKeybinding}from"../common/keybindings.js";import*as platform from"../common/platform.js";function extractKeyCode(e){if(e.charCode){let t=String.fromCharCode(e.charCode).toUpperCase();return KeyCodeUtils.fromString(t)}const t=e.keyCode;if(3===t)return 7;if(browser.isFirefox){if(59===t)return 80;if(107===t)return 81;if(109===t)return 83;if(platform.isMacintosh&&224===t)return 57}else if(browser.isWebKit){if(91===t)return 57;if(platform.isMacintosh&&93===t)return 57;if(!platform.isMacintosh&&92===t)return 57}return EVENT_KEY_CODE_MAP[t]||0}const ctrlKeyMod=platform.isMacintosh?256:2048,altKeyMod=512,shiftKeyMod=1024,metaKeyMod=platform.isMacintosh?2048:256;export class StandardKeyboardEvent{constructor(e){this._standardKeyboardEventBrand=!0;let t=e;this.browserEvent=t,this.target=t.target,this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey,this.altKey=t.altKey,this.metaKey=t.metaKey,this.keyCode=extractKeyCode(t),this.code=t.code,this.ctrlKey=this.ctrlKey||5===this.keyCode,this.altKey=this.altKey||6===this.keyCode,this.shiftKey=this.shiftKey||4===this.keyCode,this.metaKey=this.metaKey||57===this.keyCode,this._asKeybinding=this._computeKeybinding(),this._asRuntimeKeybinding=this._computeRuntimeKeybinding()}preventDefault(){this.browserEvent&&this.browserEvent.preventDefault&&this.browserEvent.preventDefault()}stopPropagation(){this.browserEvent&&this.browserEvent.stopPropagation&&this.browserEvent.stopPropagation()}toKeybinding(){return this._asRuntimeKeybinding}equals(e){return this._asKeybinding===e}_computeKeybinding(){let e=0;5!==this.keyCode&&4!==this.keyCode&&6!==this.keyCode&&57!==this.keyCode&&(e=this.keyCode);let t=0;return this.ctrlKey&&(t|=ctrlKeyMod),this.altKey&&(t|=altKeyMod),this.shiftKey&&(t|=shiftKeyMod),this.metaKey&&(t|=metaKeyMod),t|=e,t}_computeRuntimeKeybinding(){let e=0;return 5!==this.keyCode&&4!==this.keyCode&&6!==this.keyCode&&57!==this.keyCode&&(e=this.keyCode),new SimpleKeybinding(this.ctrlKey,this.shiftKey,this.altKey,this.metaKey,e)}}