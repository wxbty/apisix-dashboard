import*as platform from"./platform.js";import{URI}from"./uri.js";export var Schemas;(function(e){e.inMemory="inmemory",e.vscode="vscode",e.internal="private",e.walkThrough="walkThrough",e.walkThroughSnippet="walkThroughSnippet",e.http="http",e.https="https",e.file="file",e.mailto="mailto",e.untitled="untitled",e.data="data",e.command="command",e.vscodeRemote="vscode-remote",e.vscodeRemoteResource="vscode-remote-resource",e.userData="vscode-userdata",e.vscodeCustomEditor="vscode-custom-editor",e.vscodeNotebook="vscode-notebook",e.vscodeNotebookCell="vscode-notebook-cell",e.vscodeNotebookCellMetadata="vscode-notebook-cell-metadata",e.vscodeNotebookCellOutput="vscode-notebook-cell-output",e.vscodeInteractive="vscode-interactive",e.vscodeInteractiveInput="vscode-interactive-input",e.vscodeSettings="vscode-settings",e.vscodeWorkspaceTrust="vscode-workspace-trust",e.vscodeTerminal="vscode-terminal",e.webviewPanel="webview-panel",e.vscodeWebview="vscode-webview",e.extension="extension",e.vscodeFileResource="vscode-file",e.tmp="tmp",e.vsls="vsls"})(Schemas||(Schemas={}));export const connectionTokenQueryName="tkn";class RemoteAuthoritiesImpl{constructor(){this._hosts=Object.create(null),this._ports=Object.create(null),this._connectionTokens=Object.create(null),this._preferredWebSchema="http",this._delegate=null}setPreferredWebSchema(e){this._preferredWebSchema=e}rewrite(e){if(this._delegate)return this._delegate(e);const t=e.authority;let o=this._hosts[t];o&&-1!==o.indexOf(":")&&(o=`[${o}]`);const s=this._ports[t],c=this._connectionTokens[t];let r=`path=${encodeURIComponent(e.path)}`;return"string"===typeof c&&(r+=`&${connectionTokenQueryName}=${encodeURIComponent(c)}`),URI.from({scheme:platform.isWeb?this._preferredWebSchema:Schemas.vscodeRemoteResource,authority:`${o}:${s}`,path:"/vscode-remote-resource",query:r})}}export const RemoteAuthorities=new RemoteAuthoritiesImpl;class FileAccessImpl{asBrowserUri(e,t){const o=this.toUri(e,t);return o.scheme===Schemas.vscodeRemote?RemoteAuthorities.rewrite(o):o.scheme===Schemas.file&&(platform.isNative||"function"===typeof platform.globals.importScripts&&platform.globals.origin===`${Schemas.vscodeFileResource}://${FileAccessImpl.FALLBACK_AUTHORITY}`)?o.with({scheme:Schemas.vscodeFileResource,authority:o.authority||FileAccessImpl.FALLBACK_AUTHORITY,query:null,fragment:null}):o}toUri(e,t){return URI.isUri(e)?e:URI.parse(t.toUrl(e))}}FileAccessImpl.FALLBACK_AUTHORITY="vscode-app";export const FileAccess=new FileAccessImpl;