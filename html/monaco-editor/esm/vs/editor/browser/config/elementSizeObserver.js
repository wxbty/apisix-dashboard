import{Disposable}from"../../../base/common/lifecycle.js";import{Emitter}from"../../../base/common/event.js";export class ElementSizeObserver extends Disposable{constructor(e,t){super(),this._onDidChange=this._register(new Emitter),this.onDidChange=this._onDidChange.event,this._referenceDomElement=e,this._width=-1,this._height=-1,this._resizeObserver=null,this.measureReferenceDomElement(!1,t)}dispose(){this.stopObserving(),super.dispose()}getWidth(){return this._width}getHeight(){return this._height}startObserving(){!this._resizeObserver&&this._referenceDomElement&&(this._resizeObserver=new ResizeObserver((e=>{e&&e[0]&&e[0].contentRect?this.observe({width:e[0].contentRect.width,height:e[0].contentRect.height}):this.observe()})),this._resizeObserver.observe(this._referenceDomElement))}stopObserving(){this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=null)}observe(e){this.measureReferenceDomElement(!0,e)}measureReferenceDomElement(e,t){let s=0,i=0;t?(s=t.width,i=t.height):this._referenceDomElement&&(s=this._referenceDomElement.clientWidth,i=this._referenceDomElement.clientHeight),s=Math.max(5,s),i=Math.max(5,i),this._width===s&&this._height===i||(this._width=s,this._height=i,e&&this._onDidChange.fire())}}