var __awaiter=this&&this.__awaiter||function(e,n,t,r){function o(e){return e instanceof t?e:new t((function(n){n(e)}))}return new(t||(t=Promise))((function(t,i){function a(e){try{c(r.next(e))}catch(n){i(n)}}function s(e){try{c(r["throw"](e))}catch(n){i(n)}}function c(e){e.done?t(e.value):o(e.value).then(a,s)}c((r=r.apply(e,n||[])).next())}))};import{binarySearch,isFalsyOrEmpty}from"../../../../base/common/arrays.js";import{Range}from"../../../common/core/range.js";import{BracketSelectionRangeProvider}from"../../smartSelect/browser/bracketSelections.js";export class WordDistance{static create(e,n){return __awaiter(this,void 0,void 0,(function*(){if(!n.getOption(106).localityBonus)return WordDistance.None;if(!n.hasModel())return WordDistance.None;const t=n.getModel(),r=n.getPosition();if(!e.canComputeWordRanges(t.uri))return WordDistance.None;const[o]=yield(new BracketSelectionRangeProvider).provideSelectionRanges(t,[r]);if(0===o.length)return WordDistance.None;const i=yield e.computeWordRanges(t.uri,o[0].range);if(!i)return WordDistance.None;const a=t.getWordUntilPosition(r);return delete i[a.word],new class extends WordDistance{distance(e,t){if(!r.equals(n.getPosition()))return 0;if(17===t.kind)return 2<<20;let a="string"===typeof t.label?t.label:t.label.label,s=i[a];if(isFalsyOrEmpty(s))return 2<<20;let c=binarySearch(s,Range.fromPositions(e),Range.compareRangesUsingStarts),l=c>=0?s[c]:s[Math.max(0,~c-1)],u=o.length;for(const n of o){if(!Range.containsRange(n.range,l))break;u-=1}return u}}}))}}WordDistance.None=new class extends WordDistance{distance(){return 0}};