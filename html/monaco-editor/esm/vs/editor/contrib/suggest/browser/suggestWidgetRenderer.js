var _a,__decorate=this&&this.__decorate||function(e,t,o,s){var i,a=arguments.length,n=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,o):s;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)n=Reflect.decorate(e,t,o,s);else for(var r=e.length-1;r>=0;r--)(i=e[r])&&(n=(a<3?i(n):a>3?i(t,o,n):i(t,o))||n);return a>3&&n&&Object.defineProperty(t,o,n),n},__param=this&&this.__param||function(e,t){return function(o,s){t(o,s,e)}};import{isSafari}from"../../../../base/browser/browser.js";import{$,append,hide,show}from"../../../../base/browser/dom.js";import{IconLabel}from"../../../../base/browser/ui/iconLabel/iconLabel.js";import{flatten}from"../../../../base/common/arrays.js";import{Codicon,CSSIcon}from"../../../../base/common/codicons.js";import{Emitter}from"../../../../base/common/event.js";import{createMatches}from"../../../../base/common/filters.js";import{DisposableStore}from"../../../../base/common/lifecycle.js";import{URI}from"../../../../base/common/uri.js";import{EDITOR_FONT_DEFAULTS}from"../../../common/config/editorOptions.js";import{CompletionItemKinds}from"../../../common/languages.js";import{getIconClasses}from"../../../common/services/getIconClasses.js";import{IModelService}from"../../../common/services/model.js";import{ILanguageService}from"../../../common/services/language.js";import*as nls from"../../../../nls.js";import{FileKind}from"../../../../platform/files/common/files.js";import{registerIcon}from"../../../../platform/theme/common/iconRegistry.js";import{IThemeService,ThemeIcon}from"../../../../platform/theme/common/themeService.js";import{canExpandCompletionItem}from"./suggestWidgetDetails.js";export function getAriaId(e){return`suggest-aria-id:${e}`}export const suggestMoreInfoIcon=registerIcon("suggest-more-info",Codicon.chevronRight,nls.localize("suggestMoreInfoIcon","Icon for more information in the suggest widget."));const _completionItemColor=new(_a=class e{extract(t,o){if(t.textLabel.match(e._regexStrict))return o[0]=t.textLabel,!0;if(t.completion.detail&&t.completion.detail.match(e._regexStrict))return o[0]=t.completion.detail,!0;if("string"===typeof t.completion.documentation){const s=e._regexRelaxed.exec(t.completion.documentation);if(s&&(0===s.index||s.index+s[0].length===t.completion.documentation.length))return o[0]=s[0],!0}return!1}},_a._regexRelaxed=/(#([\da-fA-F]{3}){1,2}|(rgb|hsl)a\(\s*(\d{1,3}%?\s*,\s*){3}(1|0?\.\d+)\)|(rgb|hsl)\(\s*\d{1,3}%?(\s*,\s*\d{1,3}%?){2}\s*\))/,_a._regexStrict=new RegExp(`^${_a._regexRelaxed.source}$`,"i"),_a);let ItemRenderer=class{constructor(e,t,o,s){this._editor=e,this._modelService=t,this._languageService=o,this._themeService=s,this._onDidToggleDetails=new Emitter,this.onDidToggleDetails=this._onDidToggleDetails.event,this.templateId="suggestion"}dispose(){this._onDidToggleDetails.dispose()}renderTemplate(e){const t=Object.create(null);t.disposables=new DisposableStore,t.root=e,t.root.classList.add("show-file-icons"),t.icon=append(e,$(".icon")),t.colorspan=append(t.icon,$("span.colorspan"));const o=append(e,$(".contents")),s=append(o,$(".main"));t.iconContainer=append(s,$(".icon-label.codicon")),t.left=append(s,$("span.left")),t.right=append(s,$("span.right")),t.iconLabel=new IconLabel(t.left,{supportHighlights:!0,supportIcons:!0}),t.disposables.add(t.iconLabel),t.parametersLabel=append(t.left,$("span.signature-label")),t.qualifierLabel=append(t.left,$("span.qualifier-label")),t.detailsLabel=append(t.right,$("span.details-label")),t.readMore=append(t.right,$("span.readMore"+ThemeIcon.asCSSSelector(suggestMoreInfoIcon))),t.readMore.title=nls.localize("readMore","Read More");const i=()=>{const e=this._editor.getOptions(),o=e.get(44),i=o.getMassagedFontFamily(isSafari?EDITOR_FONT_DEFAULTS.fontFamily:null),a=o.fontFeatureSettings,n=e.get(107)||o.fontSize,r=e.get(108)||o.lineHeight,l=o.fontWeight,c=`${n}px`,m=`${r}px`;t.root.style.fontSize=c,t.root.style.fontWeight=l,s.style.fontFamily=i,s.style.fontFeatureSettings=a,s.style.lineHeight=m,t.icon.style.height=m,t.icon.style.width=m,t.readMore.style.height=m,t.readMore.style.width=m};return i(),t.disposables.add(this._editor.onDidChangeConfiguration((e=>{(e.hasChanged(44)||e.hasChanged(107)||e.hasChanged(108))&&i()}))),t}renderElement(e,t,o){const{completion:s}=e;o.root.id=getAriaId(t),o.colorspan.style.backgroundColor="";const i={labelEscapeNewLines:!0,matches:createMatches(e.score)};let a=[];if(19===s.kind&&_completionItemColor.extract(e,a))o.icon.className="icon customcolor",o.iconContainer.className="icon hide",o.colorspan.style.backgroundColor=a[0];else if(20===s.kind&&this._themeService.getFileIconTheme().hasFileIcons){o.icon.className="icon hide",o.iconContainer.className="icon hide";const t=getIconClasses(this._modelService,this._languageService,URI.from({scheme:"fake",path:e.textLabel}),FileKind.FILE),a=getIconClasses(this._modelService,this._languageService,URI.from({scheme:"fake",path:s.detail}),FileKind.FILE);i.extraClasses=t.length>a.length?t:a}else 23===s.kind&&this._themeService.getFileIconTheme().hasFolderIcons?(o.icon.className="icon hide",o.iconContainer.className="icon hide",i.extraClasses=flatten([getIconClasses(this._modelService,this._languageService,URI.from({scheme:"fake",path:e.textLabel}),FileKind.FOLDER),getIconClasses(this._modelService,this._languageService,URI.from({scheme:"fake",path:s.detail}),FileKind.FOLDER)])):(o.icon.className="icon hide",o.iconContainer.className="",o.iconContainer.classList.add("suggest-icon",...CSSIcon.asClassNameArray(CompletionItemKinds.toIcon(s.kind))));s.tags&&s.tags.indexOf(1)>=0&&(i.extraClasses=(i.extraClasses||[]).concat(["deprecated"]),i.matches=[]),o.iconLabel.setLabel(e.textLabel,void 0,i),"string"===typeof s.label?(o.parametersLabel.textContent="",o.detailsLabel.textContent=stripNewLines(s.detail||""),o.root.classList.add("string-label")):(o.parametersLabel.textContent=stripNewLines(s.label.detail||""),o.detailsLabel.textContent=stripNewLines(s.label.description||""),o.root.classList.remove("string-label")),this._editor.getOption(106).showInlineDetails?show(o.detailsLabel):hide(o.detailsLabel),canExpandCompletionItem(e)?(o.right.classList.add("can-expand-details"),show(o.readMore),o.readMore.onmousedown=e=>{e.stopPropagation(),e.preventDefault()},o.readMore.onclick=e=>{e.stopPropagation(),e.preventDefault(),this._onDidToggleDetails.fire()}):(o.right.classList.remove("can-expand-details"),hide(o.readMore),o.readMore.onmousedown=null,o.readMore.onclick=null)}disposeTemplate(e){e.disposables.dispose()}};ItemRenderer=__decorate([__param(1,IModelService),__param(2,ILanguageService),__param(3,IThemeService)],ItemRenderer);export{ItemRenderer};function stripNewLines(e){return e.replace(/\r\n|\r|\n/g,"")}