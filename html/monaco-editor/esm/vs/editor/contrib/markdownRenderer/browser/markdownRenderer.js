var _a,__decorate=this&&this.__decorate||function(e,n,o,t){var r,i=arguments.length,s=i<3?n:null===t?t=Object.getOwnPropertyDescriptor(n,o):t;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,n,o,t);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(n,o,s):r(n,o))||s);return i>3&&s&&Object.defineProperty(n,o,s),s},__param=this&&this.__param||function(e,n){return function(o,t){n(o,t,e)}},__awaiter=this&&this.__awaiter||function(e,n,o,t){function r(e){return e instanceof o?e:new o((function(n){n(e)}))}return new(o||(o=Promise))((function(o,i){function s(e){try{c(t.next(e))}catch(n){i(n)}}function a(e){try{c(t["throw"](e))}catch(n){i(n)}}function c(e){e.done?o(e.value):r(e.value).then(s,a)}c((t=t.apply(e,n||[])).next())}))};import{renderMarkdown}from"../../../../base/browser/markdownRenderer.js";import{IOpenerService}from"../../../../platform/opener/common/opener.js";import{ILanguageService}from"../../../common/services/language.js";import{onUnexpectedError}from"../../../../base/common/errors.js";import{tokenizeToString}from"../../../common/languages/textToHtmlTokenizer.js";import{Emitter}from"../../../../base/common/event.js";import{DisposableStore}from"../../../../base/common/lifecycle.js";import{applyFontInfo}from"../../../browser/config/domFontInfo.js";import{PLAINTEXT_LANGUAGE_ID}from"../../../common/languages/modesRegistry.js";let MarkdownRenderer=class e{constructor(e,n,o){this._options=e,this._languageService=n,this._openerService=o,this._onDidRenderAsync=new Emitter,this.onDidRenderAsync=this._onDidRenderAsync.event}dispose(){this._onDidRenderAsync.dispose()}render(e,n,o){if(!e){const e=document.createElement("span");return{element:e,dispose:()=>{}}}const t=new DisposableStore,r=t.add(renderMarkdown(e,Object.assign(Object.assign({},this._getRenderOptions(e,t)),n),o));return{element:r.element,dispose:()=>t.dispose()}}_getRenderOptions(n,o){return{baseUrl:this._options.baseUrl,codeBlockRenderer:(n,o)=>__awaiter(this,void 0,void 0,(function*(){var t,r,i;let s;n?s=this._languageService.getLanguageIdByLanguageName(n):this._options.editor&&(s=null===(t=this._options.editor.getModel())||void 0===t?void 0:t.getLanguageId()),s||(s=PLAINTEXT_LANGUAGE_ID);const a=yield tokenizeToString(this._languageService,o,s),c=document.createElement("span");if(c.innerHTML=null!==(i=null===(r=e._ttpTokenizer)||void 0===r?void 0:r.createHTML(a))&&void 0!==i?i:a,this._options.editor){const e=this._options.editor.getOption(44);applyFontInfo(c,e)}else this._options.codeBlockFontFamily&&(c.style.fontFamily=this._options.codeBlockFontFamily);return c})),asyncRenderCallback:()=>this._onDidRenderAsync.fire(),actionHandler:{callback:e=>this._openerService.open(e,{fromUserGesture:!0,allowContributedOpeners:!0,allowCommands:n.isTrusted}).catch(onUnexpectedError),disposables:o}}}};MarkdownRenderer._ttpTokenizer=null===(_a=window.trustedTypes)||void 0===_a?void 0:_a.createPolicy("tokenizeToString",{createHTML(e){return e}}),MarkdownRenderer=__decorate([__param(1,ILanguageService),__param(2,IOpenerService)],MarkdownRenderer);export{MarkdownRenderer};