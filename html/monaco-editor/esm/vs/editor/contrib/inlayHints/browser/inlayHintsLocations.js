var __awaiter=this&&this.__awaiter||function(o,e,t,i){function n(o){return o instanceof t?o:new t((function(e){e(o)}))}return new(t||(t=Promise))((function(t,r){function a(o){try{s(i.next(o))}catch(e){r(e)}}function c(o){try{s(i["throw"](o))}catch(e){r(e)}}function s(o){o.done?t(o.value):n(o.value).then(a,c)}s((i=i.apply(o,e||[])).next())}))};import*as dom from"../../../../base/browser/dom.js";import{Action,Separator}from"../../../../base/common/actions.js";import{CancellationToken}from"../../../../base/common/cancellation.js";import{EditorExtensionsRegistry}from"../../../browser/editorExtensions.js";import{Range}from"../../../common/core/range.js";import{ITextModelService}from"../../../common/services/resolverService.js";import{DefinitionAction,SymbolNavigationAction,SymbolNavigationAnchor}from"../../gotoSymbol/browser/goToCommands.js";import{PeekContext}from"../../peekView/browser/peekView.js";import{isIMenuItem,MenuId,MenuRegistry}from"../../../../platform/actions/common/actions.js";import{ICommandService}from"../../../../platform/commands/common/commands.js";import{IContextKeyService}from"../../../../platform/contextkey/common/contextkey.js";import{IContextMenuService}from"../../../../platform/contextview/browser/contextView.js";import{IInstantiationService}from"../../../../platform/instantiation/common/instantiation.js";import{INotificationService,Severity}from"../../../../platform/notification/common/notification.js";export function showGoToContextMenu(o,e,t,i){var n;return __awaiter(this,void 0,void 0,(function*(){const r=o.get(ITextModelService),a=o.get(IContextMenuService),c=o.get(ICommandService),s=o.get(IInstantiationService),m=o.get(INotificationService);if(yield i.item.resolve(CancellationToken.None),!i.part.location)return;const d=i.part.location,f=[],l=new Set(MenuRegistry.getMenuItems(MenuId.EditorContext).map((o=>isIMenuItem(o)?o.command.id:"")));for(const o of EditorExtensionsRegistry.getEditorActions())o instanceof SymbolNavigationAction&&l.has(o.id)&&f.push(new Action(o.id,o.label,void 0,!0,(()=>__awaiter(this,void 0,void 0,(function*(){const t=yield r.createModelReference(d.uri);try{yield s.invokeFunction(o.run.bind(o),e,new SymbolNavigationAnchor(t.object.textEditorModel,Range.getStartPosition(d.range)))}finally{t.dispose()}})))));if(i.part.command){const{command:o}=i.part;f.push(new Separator),f.push(new Action(o.id,o.title,void 0,!0,(()=>__awaiter(this,void 0,void 0,(function*(){var e;try{yield c.executeCommand(o.id,...null!==(e=o.arguments)&&void 0!==e?e:[])}catch(t){m.notify({severity:Severity.Error,source:i.item.provider.displayName,message:t})}})))))}const u=e.getOption(115);a.showContextMenu({domForShadowRoot:u&&null!==(n=e.getDomNode())&&void 0!==n?n:void 0,getAnchor:()=>{const o=dom.getDomNodePagePosition(t);return{x:o.left,y:o.top+o.height+8}},getActions:()=>f,onHide:()=>{e.focus()},autoSelectFirstItem:!0})}))}export function goToDefinitionWithLocation(o,e,t,i){return __awaiter(this,void 0,void 0,(function*(){const n=o.get(ITextModelService),r=yield n.createModelReference(i.uri);yield t.invokeWithinContext((o=>__awaiter(this,void 0,void 0,(function*(){const n=e.hasSideBySideModifier,a=o.get(IContextKeyService),c=PeekContext.inPeekEditor.getValue(a),s=!n&&t.getOption(78)&&!c,m=new DefinitionAction({openToSide:n,openInPeek:s,muteMessage:!0},{alias:"",label:"",id:"",precondition:void 0});return m.run(o,t,{model:r.object.textEditorModel,position:Range.getStartPosition(i.range)})})))),r.dispose()}))}