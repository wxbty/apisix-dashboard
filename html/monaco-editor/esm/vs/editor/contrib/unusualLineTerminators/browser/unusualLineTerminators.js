var __decorate=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,s=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(o<3?n(s):o>3?n(t,r,s):n(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s},__param=this&&this.__param||function(e,t){return function(r,i){t(r,i,e)}},__awaiter=this&&this.__awaiter||function(e,t,r,i){function n(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function s(e){try{u(i.next(e))}catch(t){o(t)}}function a(e){try{u(i["throw"](e))}catch(t){o(t)}}function u(e){e.done?r(e.value):n(e.value).then(s,a)}u((i=i.apply(e,t||[])).next())}))};import{Disposable}from"../../../../base/common/lifecycle.js";import{basename}from"../../../../base/common/resources.js";import{registerEditorContribution}from"../../../browser/editorExtensions.js";import{ICodeEditorService}from"../../../browser/services/codeEditorService.js";import*as nls from"../../../../nls.js";import{IDialogService}from"../../../../platform/dialogs/common/dialogs.js";const ignoreUnusualLineTerminators="ignoreUnusualLineTerminators";function writeIgnoreState(e,t,r){e.setModelProperty(t.uri,ignoreUnusualLineTerminators,r)}function readIgnoreState(e,t){return e.getModelProperty(t.uri,ignoreUnusualLineTerminators)}let UnusualLineTerminatorsDetector=class extends Disposable{constructor(e,t,r){super(),this._editor=e,this._dialogService=t,this._codeEditorService=r,this._config=this._editor.getOption(114),this._register(this._editor.onDidChangeConfiguration((e=>{e.hasChanged(114)&&(this._config=this._editor.getOption(114),this._checkForUnusualLineTerminators())}))),this._register(this._editor.onDidChangeModel((()=>{this._checkForUnusualLineTerminators()}))),this._register(this._editor.onDidChangeModelContent((e=>{e.isUndoing||this._checkForUnusualLineTerminators()})))}_checkForUnusualLineTerminators(){return __awaiter(this,void 0,void 0,(function*(){if("off"===this._config)return;if(!this._editor.hasModel())return;const e=this._editor.getModel();if(!e.mightContainUnusualLineTerminators())return;const t=readIgnoreState(this._codeEditorService,e);if(!0===t)return;if(this._editor.getOption(81))return;if("auto"===this._config)return void e.removeUnusualLineTerminators(this._editor.getSelections());const r=yield this._dialogService.confirm({title:nls.localize("unusualLineTerminators.title","Unusual Line Terminators"),message:nls.localize("unusualLineTerminators.message","Detected unusual line terminators"),detail:nls.localize("unusualLineTerminators.detail","The file '{0}' contains one or more unusual line terminator characters, like Line Separator (LS) or Paragraph Separator (PS).\n\nIt is recommended to remove them from the file. This can be configured via `editor.unusualLineTerminators`.",basename(e.uri)),primaryButton:nls.localize("unusualLineTerminators.fix","Remove Unusual Line Terminators"),secondaryButton:nls.localize("unusualLineTerminators.ignore","Ignore")});r.confirmed?e.removeUnusualLineTerminators(this._editor.getSelections()):writeIgnoreState(this._codeEditorService,e,!0)}))}};UnusualLineTerminatorsDetector.ID="editor.contrib.unusualLineTerminatorsDetector",UnusualLineTerminatorsDetector=__decorate([__param(1,IDialogService),__param(2,ICodeEditorService)],UnusualLineTerminatorsDetector);export{UnusualLineTerminatorsDetector};registerEditorContribution(UnusualLineTerminatorsDetector.ID,UnusualLineTerminatorsDetector);