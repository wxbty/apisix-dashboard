import{CancellationToken}from"../../../../base/common/cancellation.js";import{illegalArgument}from"../../../../base/common/errors.js";import{URI}from"../../../../base/common/uri.js";import{Range}from"../../../common/core/range.js";import{ColorProviderRegistry}from"../../../common/languages.js";import{IModelService}from"../../../common/services/model.js";import{CommandsRegistry}from"../../../../platform/commands/common/commands.js";export function getColors(e,o){const r=[],n=ColorProviderRegistry.ordered(e).reverse(),t=n.map((n=>Promise.resolve(n.provideDocumentColors(e,o)).then((e=>{if(Array.isArray(e))for(let o of e)r.push({colorInfo:o,provider:n})}))));return Promise.all(t).then((()=>r))}export function getColorPresentations(e,o,r,n){return Promise.resolve(r.provideColorPresentations(e,o,n))}CommandsRegistry.registerCommand("_executeDocumentColorProvider",(function(e,...o){const[r]=o;if(!(r instanceof URI))throw illegalArgument();const n=e.get(IModelService).getModel(r);if(!n)throw illegalArgument();const t=[],i=ColorProviderRegistry.ordered(n).reverse(),s=i.map((e=>Promise.resolve(e.provideDocumentColors(n,CancellationToken.None)).then((e=>{if(Array.isArray(e))for(let o of e)t.push({range:o.range,color:[o.color.red,o.color.green,o.color.blue,o.color.alpha]})}))));return Promise.all(s).then((()=>t))})),CommandsRegistry.registerCommand("_executeColorPresentationProvider",(function(e,...o){const[r,n]=o,{uri:t,range:i}=n;if(!(t instanceof URI)||!Array.isArray(r)||4!==r.length||!Range.isIRange(i))throw illegalArgument();const[s,l,m,a]=r,c=e.get(IModelService).getModel(t);if(!c)throw illegalArgument();const g={range:i,color:{red:s,green:l,blue:m,alpha:a}},d=[],u=ColorProviderRegistry.ordered(c).reverse(),f=u.map((e=>Promise.resolve(e.provideColorPresentations(c,g,CancellationToken.None)).then((e=>{Array.isArray(e)&&d.push(...e)}))));return Promise.all(f).then((()=>d))}));