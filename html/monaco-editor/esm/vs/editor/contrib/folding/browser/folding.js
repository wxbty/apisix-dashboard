var __decorate=this&&this.__decorate||function(e,t,o,i){var n,l=arguments.length,r=l<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)r=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(r=(l<3?n(r):l>3?n(t,o,r):n(t,o))||r);return l>3&&r&&Object.defineProperty(t,o,r),r},__param=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};import{createCancelablePromise,Delayer,RunOnceScheduler}from"../../../../base/common/async.js";import{onUnexpectedError}from"../../../../base/common/errors.js";import{KeyChord}from"../../../../base/common/keyCodes.js";import{Disposable,DisposableStore}from"../../../../base/common/lifecycle.js";import{escapeRegExpCharacters}from"../../../../base/common/strings.js";import*as types from"../../../../base/common/types.js";import"./folding.css";import{StableEditorScrollState}from"../../../browser/stableEditorScroll.js";import{EditorAction,registerEditorAction,registerEditorContribution,registerInstantiatedEditorAction}from"../../../browser/editorExtensions.js";import{EditorContextKeys}from"../../../common/editorContextKeys.js";import{FoldingRangeKind,FoldingRangeProviderRegistry}from"../../../common/languages.js";import{ILanguageConfigurationService}from"../../../common/languages/languageConfigurationRegistry.js";import{FoldingModel,getNextFoldLine,getParentFoldLine,getPreviousFoldLine,setCollapseStateAtLevel,setCollapseStateForMatchingLines,setCollapseStateForRest,setCollapseStateForType,setCollapseStateLevelsDown,setCollapseStateLevelsUp,setCollapseStateUp,toggleCollapseState}from"./foldingModel.js";import{HiddenRangeModel}from"./hiddenRangeModel.js";import{IndentRangeProvider}from"./indentRangeProvider.js";import{ID_INIT_PROVIDER,InitializingRangeProvider}from"./intializingRangeProvider.js";import*as nls from"../../../../nls.js";import{IContextKeyService,RawContextKey}from"../../../../platform/contextkey/common/contextkey.js";import{editorSelectionBackground,iconForeground,registerColor,transparent}from"../../../../platform/theme/common/colorRegistry.js";import{registerThemingParticipant,ThemeIcon}from"../../../../platform/theme/common/themeService.js";import{foldingCollapsedIcon,FoldingDecorationProvider,foldingExpandedIcon}from"./foldingDecorations.js";import{ID_SYNTAX_PROVIDER,SyntaxRangeProvider}from"./syntaxRangeProvider.js";import{INotificationService}from"../../../../platform/notification/common/notification.js";import Severity from"../../../../base/common/severity.js";import{ILanguageFeatureDebounceService}from"../../../common/services/languageFeatureDebounce.js";import{StopWatch}from"../../../../base/common/stopwatch.js";const CONTEXT_FOLDING_ENABLED=new RawContextKey("foldingEnabled",!1);let FoldingController=class e extends Disposable{constructor(e,t,o,i,n){super(),this.contextKeyService=t,this.languageConfigurationService=o,this._tooManyRegionsNotified=!1,this.localToDispose=this._register(new DisposableStore),this.editor=e;const l=this.editor.getOptions();this._isEnabled=l.get(37),this._useFoldingProviders="indentation"!==l.get(38),this._unfoldOnClickAfterEndOfLine=l.get(42),this._restoringViewState=!1,this._currentModelHasFoldedImports=!1,this._foldingImportsByDefault=l.get(40),this._maxFoldingRegions=l.get(41),this.updateDebounceInfo=n.for(FoldingRangeProviderRegistry,"Folding",{min:200}),this.foldingModel=null,this.hiddenRangeModel=null,this.rangeProvider=null,this.foldingRegionPromise=null,this.foldingStateMemento=null,this.foldingModelPromise=null,this.updateScheduler=null,this.cursorChangedScheduler=null,this.mouseDownInfo=null,this.foldingDecorationProvider=new FoldingDecorationProvider(e),this.foldingDecorationProvider.autoHideFoldingControls="mouseover"===l.get(99),this.foldingDecorationProvider.showFoldingHighlights=l.get(39),this.foldingEnabled=CONTEXT_FOLDING_ENABLED.bindTo(this.contextKeyService),this.foldingEnabled.set(this._isEnabled),this._notifyTooManyRegions=e=>{this._tooManyRegionsNotified||(i.notify({severity:Severity.Warning,sticky:!0,message:nls.localize("maximum fold ranges","The number of foldable regions is limited to a maximum of {0}. Increase configuration option ['Folding Maximum Regions'](command:workbench.action.openSettings?[\"editor.foldingMaximumRegions\"]) to enable more.",e)}),this._tooManyRegionsNotified=!0)},this._register(this.editor.onDidChangeModel((()=>this.onModelChanged()))),this._register(this.editor.onDidChangeConfiguration((e=>{if(e.hasChanged(37)&&(this._isEnabled=this.editor.getOptions().get(37),this.foldingEnabled.set(this._isEnabled),this.onModelChanged()),e.hasChanged(41)&&(this._maxFoldingRegions=this.editor.getOptions().get(41),this._tooManyRegionsNotified=!1,this.onModelChanged()),e.hasChanged(99)||e.hasChanged(39)){const e=this.editor.getOptions();this.foldingDecorationProvider.autoHideFoldingControls="mouseover"===e.get(99),this.foldingDecorationProvider.showFoldingHighlights=e.get(39),this.triggerFoldingModelChanged()}e.hasChanged(38)&&(this._useFoldingProviders="indentation"!==this.editor.getOptions().get(38),this.onFoldingStrategyChanged()),e.hasChanged(42)&&(this._unfoldOnClickAfterEndOfLine=this.editor.getOptions().get(42)),e.hasChanged(40)&&(this._foldingImportsByDefault=this.editor.getOptions().get(40))}))),this.onModelChanged()}static get(t){return t.getContribution(e.ID)}saveViewState(){let e=this.editor.getModel();if(!e||!this._isEnabled||e.isTooLargeForTokenization())return{};if(this.foldingModel){let t=this.foldingModel.isInitialized?this.foldingModel.getMemento():this.hiddenRangeModel.getMemento(),o=this.rangeProvider?this.rangeProvider.id:void 0;return{collapsedRegions:t,lineCount:e.getLineCount(),provider:o,foldedImports:this._currentModelHasFoldedImports}}}restoreViewState(e){let t=this.editor.getModel();if(!t||!this._isEnabled||t.isTooLargeForTokenization()||!this.hiddenRangeModel)return;if(!e||e.lineCount!==t.getLineCount())return;if(this._currentModelHasFoldedImports=!!e.foldedImports,!e.collapsedRegions)return;e.provider!==ID_SYNTAX_PROVIDER&&e.provider!==ID_INIT_PROVIDER||(this.foldingStateMemento=e);const o=e.collapsedRegions;if(this.hiddenRangeModel.applyMemento(o)){const e=this.getFoldingModel();e&&e.then((e=>{if(e){this._restoringViewState=!0;try{e.applyMemento(o)}finally{this._restoringViewState=!1}}})).then(void 0,onUnexpectedError)}}onModelChanged(){this.localToDispose.clear();let e=this.editor.getModel();this._isEnabled&&e&&!e.isTooLargeForTokenization()&&(this._currentModelHasFoldedImports=!1,this.foldingModel=new FoldingModel(e,this.foldingDecorationProvider),this.localToDispose.add(this.foldingModel),this.hiddenRangeModel=new HiddenRangeModel(this.foldingModel),this.localToDispose.add(this.hiddenRangeModel),this.localToDispose.add(this.hiddenRangeModel.onDidChange((e=>this.onHiddenRangesChanges(e)))),this.updateScheduler=new Delayer(this.updateDebounceInfo.get(e)),this.cursorChangedScheduler=new RunOnceScheduler((()=>this.revealCursor()),200),this.localToDispose.add(this.cursorChangedScheduler),this.localToDispose.add(FoldingRangeProviderRegistry.onDidChange((()=>this.onFoldingStrategyChanged()))),this.localToDispose.add(this.editor.onDidChangeModelLanguageConfiguration((()=>this.onFoldingStrategyChanged()))),this.localToDispose.add(this.editor.onDidChangeModelContent((e=>this.onDidChangeModelContent(e)))),this.localToDispose.add(this.editor.onDidChangeCursorPosition((()=>this.onCursorPositionChanged()))),this.localToDispose.add(this.editor.onMouseDown((e=>this.onEditorMouseDown(e)))),this.localToDispose.add(this.editor.onMouseUp((e=>this.onEditorMouseUp(e)))),this.localToDispose.add({dispose:()=>{this.foldingRegionPromise&&(this.foldingRegionPromise.cancel(),this.foldingRegionPromise=null),this.updateScheduler&&this.updateScheduler.cancel(),this.updateScheduler=null,this.foldingModel=null,this.foldingModelPromise=null,this.hiddenRangeModel=null,this.cursorChangedScheduler=null,this.foldingStateMemento=null,this.rangeProvider&&this.rangeProvider.dispose(),this.rangeProvider=null}}),this.triggerFoldingModelChanged())}onFoldingStrategyChanged(){this.rangeProvider&&this.rangeProvider.dispose(),this.rangeProvider=null,this.triggerFoldingModelChanged()}getRangeProvider(e){if(this.rangeProvider)return this.rangeProvider;if(this.rangeProvider=new IndentRangeProvider(e,this.languageConfigurationService,this._maxFoldingRegions),this._useFoldingProviders&&this.foldingModel){let t=FoldingRangeProviderRegistry.ordered(this.foldingModel.textModel);if(0===t.length&&this.foldingStateMemento&&this.foldingStateMemento.collapsedRegions){const t=this.rangeProvider=new InitializingRangeProvider(e,this.foldingStateMemento.collapsedRegions,(()=>{this.foldingStateMemento=null,this.onFoldingStrategyChanged()}),3e4);return t}t.length>0&&(this.rangeProvider=new SyntaxRangeProvider(e,t,(()=>this.triggerFoldingModelChanged()),this._maxFoldingRegions))}return this.foldingStateMemento=null,this.rangeProvider}getFoldingModel(){return this.foldingModelPromise}onDidChangeModelContent(e){var t;null===(t=this.hiddenRangeModel)||void 0===t||t.notifyChangeModelContent(e),this.triggerFoldingModelChanged()}triggerFoldingModelChanged(){this.updateScheduler&&(this.foldingRegionPromise&&(this.foldingRegionPromise.cancel(),this.foldingRegionPromise=null),this.foldingModelPromise=this.updateScheduler.trigger((()=>{const e=this.foldingModel;if(!e)return null;const t=new StopWatch(!0),o=this.getRangeProvider(e.textModel);let i=this.foldingRegionPromise=createCancelablePromise((e=>o.compute(e,this._notifyTooManyRegions)));return i.then((o=>{if(o&&i===this.foldingRegionPromise){let i;if(this._foldingImportsByDefault&&!this._currentModelHasFoldedImports){const e=o.setCollapsedAllOfType(FoldingRangeKind.Imports.value,!0);e&&(i=StableEditorScrollState.capture(this.editor),this._currentModelHasFoldedImports=e)}let n=this.editor.getSelections(),l=n?n.map((e=>e.startLineNumber)):[];e.update(o,l),i&&i.restore(this.editor);const r=this.updateDebounceInfo.update(e.textModel,t.elapsed());this.updateScheduler&&(this.updateScheduler.defaultDelay=r)}return e}))})).then(void 0,(e=>(onUnexpectedError(e),null))))}onHiddenRangesChanges(e){if(this.hiddenRangeModel&&e.length&&!this._restoringViewState){let e=this.editor.getSelections();e&&this.hiddenRangeModel.adjustSelections(e)&&this.editor.setSelections(e)}this.editor.setHiddenAreas(e)}onCursorPositionChanged(){this.hiddenRangeModel&&this.hiddenRangeModel.hasRanges()&&this.cursorChangedScheduler.schedule()}revealCursor(){const e=this.getFoldingModel();e&&e.then((e=>{if(e){let t=this.editor.getSelections();if(t&&t.length>0){let o=[];for(let i of t){let t=i.selectionStartLineNumber;this.hiddenRangeModel&&this.hiddenRangeModel.isHidden(t)&&o.push(...e.getAllRegionsAtLine(t,(e=>e.isCollapsed&&t>e.startLineNumber)))}o.length&&(e.toggleCollapseState(o),this.reveal(t[0].getPosition()))}}})).then(void 0,onUnexpectedError)}onEditorMouseDown(e){if(this.mouseDownInfo=null,!this.hiddenRangeModel||!e.target||!e.target.range)return;if(!e.event.leftButton&&!e.event.middleButton)return;const t=e.target.range;let o=!1;switch(e.target.type){case 4:{const t=e.target.detail,i=e.target.element.offsetLeft,n=t.offsetX-i;if(n<5)return;o=!0;break}case 7:if(this._unfoldOnClickAfterEndOfLine&&this.hiddenRangeModel.hasRanges()){const t=e.target.detail;if(!t.isAfterLines)break}return;case 6:if(this.hiddenRangeModel.hasRanges()){let e=this.editor.getModel();if(e&&t.startColumn===e.getLineMaxColumn(t.startLineNumber))break}return;default:return}this.mouseDownInfo={lineNumber:t.startLineNumber,iconClicked:o}}onEditorMouseUp(e){const t=this.getFoldingModel();if(!t||!this.mouseDownInfo||!e.target)return;let o=this.mouseDownInfo.lineNumber,i=this.mouseDownInfo.iconClicked,n=e.target.range;if(n&&n.startLineNumber===o){if(i){if(4!==e.target.type)return}else{let e=this.editor.getModel();if(!e||n.startColumn!==e.getLineMaxColumn(o))return}t.then((t=>{if(t){let n=t.getRegionAtLine(o);if(n&&n.startLineNumber===o){let l=n.isCollapsed;if(i||l){let i=e.event.altKey,r=[];if(i){let e=e=>!e.containedBy(n)&&!n.containedBy(e),o=t.getRegionsInside(null,e);for(const t of o)t.isCollapsed&&r.push(t);0===r.length&&(r=o)}else{let o=e.event.middleButton||e.event.shiftKey;if(o)for(const e of t.getRegionsInside(n))e.isCollapsed===l&&r.push(e);!l&&o&&0!==r.length||r.push(n)}t.toggleCollapseState(r),this.reveal({lineNumber:o,column:1})}}}})).then(void 0,onUnexpectedError)}}reveal(e){this.editor.revealPositionInCenterIfOutsideViewport(e,0)}};FoldingController.ID="editor.contrib.folding",FoldingController=__decorate([__param(1,IContextKeyService),__param(2,ILanguageConfigurationService),__param(3,INotificationService),__param(4,ILanguageFeatureDebounceService)],FoldingController);export{FoldingController};class FoldingAction extends EditorAction{runEditorCommand(e,t,o){const i=e.get(ILanguageConfigurationService),n=FoldingController.get(t);if(!n)return;const l=n.getFoldingModel();return l?(this.reportTelemetry(e,t),l.then((e=>{if(e){this.invoke(n,e,t,o,i);const l=t.getSelection();l&&n.reveal(l.getStartPosition())}}))):void 0}getSelectedLines(e){let t=e.getSelections();return t?t.map((e=>e.startLineNumber)):[]}getLineNumbers(e,t){return e&&e.selectionLines?e.selectionLines.map((e=>e+1)):this.getSelectedLines(t)}run(e,t){}}function foldingArgumentsConstraint(e){if(!types.isUndefined(e)){if(!types.isObject(e))return!1;const t=e;if(!types.isUndefined(t.levels)&&!types.isNumber(t.levels))return!1;if(!types.isUndefined(t.direction)&&!types.isString(t.direction))return!1;if(!types.isUndefined(t.selectionLines)&&(!types.isArray(t.selectionLines)||!t.selectionLines.every(types.isNumber)))return!1}return!0}class UnfoldAction extends FoldingAction{constructor(){super({id:"editor.unfold",label:nls.localize("unfoldAction.label","Unfold"),alias:"Unfold",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:3161,mac:{primary:2649},weight:100},description:{description:"Unfold the content in the editor",args:[{name:"Unfold editor argument",description:"Property-value pairs that can be passed through this argument:\n\t\t\t\t\t\t* 'levels': Number of levels to unfold. If not set, defaults to 1.\n\t\t\t\t\t\t* 'direction': If 'up', unfold given number of levels up otherwise unfolds down.\n\t\t\t\t\t\t* 'selectionLines': The start lines (0-based) of the editor selections to apply the unfold action to. If not set, the active selection(s) will be used.\n\t\t\t\t\t\t",constraint:foldingArgumentsConstraint,schema:{type:"object",properties:{levels:{type:"number",default:1},direction:{type:"string",enum:["up","down"],default:"down"},selectionLines:{type:"array",items:{type:"number"}}}}}]}})}invoke(e,t,o,i){let n=i&&i.levels||1,l=this.getLineNumbers(i,o);i&&"up"===i.direction?setCollapseStateLevelsUp(t,!1,n,l):setCollapseStateLevelsDown(t,!1,n,l)}}class UnFoldRecursivelyAction extends FoldingAction{constructor(){super({id:"editor.unfoldRecursively",label:nls.localize("unFoldRecursivelyAction.label","Unfold Recursively"),alias:"Unfold Recursively",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2137),weight:100}})}invoke(e,t,o,i){setCollapseStateLevelsDown(t,!1,Number.MAX_VALUE,this.getSelectedLines(o))}}class FoldAction extends FoldingAction{constructor(){super({id:"editor.fold",label:nls.localize("foldAction.label","Fold"),alias:"Fold",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:3159,mac:{primary:2647},weight:100},description:{description:"Fold the content in the editor",args:[{name:"Fold editor argument",description:"Property-value pairs that can be passed through this argument:\n\t\t\t\t\t\t\t* 'levels': Number of levels to fold.\n\t\t\t\t\t\t\t* 'direction': If 'up', folds given number of levels up otherwise folds down.\n\t\t\t\t\t\t\t* 'selectionLines': The start lines (0-based) of the editor selections to apply the fold action to. If not set, the active selection(s) will be used.\n\t\t\t\t\t\t\tIf no levels or direction is set, folds the region at the locations or if already collapsed, the first uncollapsed parent instead.\n\t\t\t\t\t\t",constraint:foldingArgumentsConstraint,schema:{type:"object",properties:{levels:{type:"number"},direction:{type:"string",enum:["up","down"]},selectionLines:{type:"array",items:{type:"number"}}}}}]}})}invoke(e,t,o,i){let n=this.getLineNumbers(i,o);const l=i&&i.levels,r=i&&i.direction;"number"!==typeof l&&"string"!==typeof r?setCollapseStateUp(t,!0,n):"up"===r?setCollapseStateLevelsUp(t,!0,l||1,n):setCollapseStateLevelsDown(t,!0,l||1,n)}}class ToggleFoldAction extends FoldingAction{constructor(){super({id:"editor.toggleFold",label:nls.localize("toggleFoldAction.label","Toggle Fold"),alias:"Toggle Fold",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2090),weight:100}})}invoke(e,t,o){let i=this.getSelectedLines(o);toggleCollapseState(t,1,i)}}class FoldRecursivelyAction extends FoldingAction{constructor(){super({id:"editor.foldRecursively",label:nls.localize("foldRecursivelyAction.label","Fold Recursively"),alias:"Fold Recursively",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2135),weight:100}})}invoke(e,t,o){let i=this.getSelectedLines(o);setCollapseStateLevelsDown(t,!0,Number.MAX_VALUE,i)}}class FoldAllBlockCommentsAction extends FoldingAction{constructor(){super({id:"editor.foldAllBlockComments",label:nls.localize("foldAllBlockComments.label","Fold All Block Comments"),alias:"Fold All Block Comments",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2133),weight:100}})}invoke(e,t,o,i,n){if(t.regions.hasTypes())setCollapseStateForType(t,FoldingRangeKind.Comment.value,!0);else{const e=o.getModel();if(!e)return;const i=n.getLanguageConfiguration(e.getLanguageId()).comments;if(i&&i.blockCommentStartToken){let e=new RegExp("^\\s*"+escapeRegExpCharacters(i.blockCommentStartToken));setCollapseStateForMatchingLines(t,e,!0)}}}}class FoldAllRegionsAction extends FoldingAction{constructor(){super({id:"editor.foldAllMarkerRegions",label:nls.localize("foldAllMarkerRegions.label","Fold All Regions"),alias:"Fold All Regions",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2077),weight:100}})}invoke(e,t,o,i,n){if(t.regions.hasTypes())setCollapseStateForType(t,FoldingRangeKind.Region.value,!0);else{const e=o.getModel();if(!e)return;const i=n.getLanguageConfiguration(e.getLanguageId()).foldingRules;if(i&&i.markers&&i.markers.start){let e=new RegExp(i.markers.start);setCollapseStateForMatchingLines(t,e,!0)}}}}class UnfoldAllRegionsAction extends FoldingAction{constructor(){super({id:"editor.unfoldAllMarkerRegions",label:nls.localize("unfoldAllMarkerRegions.label","Unfold All Regions"),alias:"Unfold All Regions",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2078),weight:100}})}invoke(e,t,o,i,n){if(t.regions.hasTypes())setCollapseStateForType(t,FoldingRangeKind.Region.value,!1);else{const e=o.getModel();if(!e)return;const i=n.getLanguageConfiguration(e.getLanguageId()).foldingRules;if(i&&i.markers&&i.markers.start){let e=new RegExp(i.markers.start);setCollapseStateForMatchingLines(t,e,!1)}}}}class FoldAllRegionsExceptAction extends FoldingAction{constructor(){super({id:"editor.foldAllExcept",label:nls.localize("foldAllExcept.label","Fold All Regions Except Selected"),alias:"Fold All Regions Except Selected",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2131),weight:100}})}invoke(e,t,o){let i=this.getSelectedLines(o);setCollapseStateForRest(t,!0,i)}}class UnfoldAllRegionsExceptAction extends FoldingAction{constructor(){super({id:"editor.unfoldAllExcept",label:nls.localize("unfoldAllExcept.label","Unfold All Regions Except Selected"),alias:"Unfold All Regions Except Selected",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2129),weight:100}})}invoke(e,t,o){let i=this.getSelectedLines(o);setCollapseStateForRest(t,!1,i)}}class FoldAllAction extends FoldingAction{constructor(){super({id:"editor.foldAll",label:nls.localize("foldAllAction.label","Fold All"),alias:"Fold All",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2069),weight:100}})}invoke(e,t,o){setCollapseStateLevelsDown(t,!0)}}class UnfoldAllAction extends FoldingAction{constructor(){super({id:"editor.unfoldAll",label:nls.localize("unfoldAllAction.label","Unfold All"),alias:"Unfold All",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2088),weight:100}})}invoke(e,t,o){setCollapseStateLevelsDown(t,!1)}}class FoldLevelAction extends FoldingAction{getFoldingLevel(){return parseInt(this.id.substr(FoldLevelAction.ID_PREFIX.length))}invoke(e,t,o){setCollapseStateAtLevel(t,this.getFoldingLevel(),!0,this.getSelectedLines(o))}}FoldLevelAction.ID_PREFIX="editor.foldLevel",FoldLevelAction.ID=e=>FoldLevelAction.ID_PREFIX+e;class GotoParentFoldAction extends FoldingAction{constructor(){super({id:"editor.gotoParentFold",label:nls.localize("gotoParentFold.label","Go to Parent Fold"),alias:"Go to Parent Fold",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,weight:100}})}invoke(e,t,o){let i=this.getSelectedLines(o);if(i.length>0){let e=getParentFoldLine(i[0],t);null!==e&&o.setSelection({startLineNumber:e,startColumn:1,endLineNumber:e,endColumn:1})}}}class GotoPreviousFoldAction extends FoldingAction{constructor(){super({id:"editor.gotoPreviousFold",label:nls.localize("gotoPreviousFold.label","Go to Previous Folding Range"),alias:"Go to Previous Folding Range",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,weight:100}})}invoke(e,t,o){let i=this.getSelectedLines(o);if(i.length>0){let e=getPreviousFoldLine(i[0],t);null!==e&&o.setSelection({startLineNumber:e,startColumn:1,endLineNumber:e,endColumn:1})}}}class GotoNextFoldAction extends FoldingAction{constructor(){super({id:"editor.gotoNextFold",label:nls.localize("gotoNextFold.label","Go to Next Folding Range"),alias:"Go to Next Folding Range",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,weight:100}})}invoke(e,t,o){let i=this.getSelectedLines(o);if(i.length>0){let e=getNextFoldLine(i[0],t);null!==e&&o.setSelection({startLineNumber:e,startColumn:1,endLineNumber:e,endColumn:1})}}}registerEditorContribution(FoldingController.ID,FoldingController),registerEditorAction(UnfoldAction),registerEditorAction(UnFoldRecursivelyAction),registerEditorAction(FoldAction),registerEditorAction(FoldRecursivelyAction),registerEditorAction(FoldAllAction),registerEditorAction(UnfoldAllAction),registerEditorAction(FoldAllBlockCommentsAction),registerEditorAction(FoldAllRegionsAction),registerEditorAction(UnfoldAllRegionsAction),registerEditorAction(FoldAllRegionsExceptAction),registerEditorAction(UnfoldAllRegionsExceptAction),registerEditorAction(ToggleFoldAction),registerEditorAction(GotoParentFoldAction),registerEditorAction(GotoPreviousFoldAction),registerEditorAction(GotoNextFoldAction);for(let e=1;e<=7;e++)registerInstantiatedEditorAction(new FoldLevelAction({id:FoldLevelAction.ID(e),label:nls.localize("foldLevelAction.label","Fold Level {0}",e),alias:`Fold Level ${e}`,precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2048|21+e),weight:100}}));export const foldBackgroundBackground=registerColor("editor.foldBackground",{light:transparent(editorSelectionBackground,.3),dark:transparent(editorSelectionBackground,.3),hc:null},nls.localize("foldBackgroundBackground","Background color behind folded ranges. The color must not be opaque so as not to hide underlying decorations."),!0);export const editorFoldForeground=registerColor("editorGutter.foldingControlForeground",{dark:iconForeground,light:iconForeground,hc:iconForeground},nls.localize("editorGutter.foldingControlForeground","Color of the folding control in the editor gutter."));registerThemingParticipant(((e,t)=>{const o=e.getColor(foldBackgroundBackground);o&&t.addRule(`.monaco-editor .folded-background { background-color: ${o}; }`);const i=e.getColor(editorFoldForeground);i&&t.addRule(`\n\t\t.monaco-editor .cldr${ThemeIcon.asCSSSelector(foldingExpandedIcon)},\n\t\t.monaco-editor .cldr${ThemeIcon.asCSSSelector(foldingCollapsedIcon)} {\n\t\t\tcolor: ${i} !important;\n\t\t}\n\t\t`)}));