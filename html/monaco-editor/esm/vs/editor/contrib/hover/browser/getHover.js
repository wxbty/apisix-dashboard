var __awaiter=this&&this.__awaiter||function(e,o,r,t){function n(e){return e instanceof r?e:new r((function(o){o(e)}))}return new(r||(r=Promise))((function(r,i){function s(e){try{a(t.next(e))}catch(o){i(o)}}function c(e){try{a(t["throw"](e))}catch(o){i(o)}}function a(e){e.done?r(e.value):n(e.value).then(s,c)}a((t=t.apply(e,o||[])).next())}))};import{AsyncIterableObject}from"../../../../base/common/async.js";import{CancellationToken}from"../../../../base/common/cancellation.js";import{onUnexpectedExternalError}from"../../../../base/common/errors.js";import{registerModelAndPositionCommand}from"../../../browser/editorExtensions.js";import{HoverProviderRegistry}from"../../../common/languages.js";export class HoverProviderResult{constructor(e,o,r){this.provider=e,this.hover=o,this.ordinal=r}}function executeProvider(e,o,r,t,n){return __awaiter(this,void 0,void 0,(function*(){try{const i=yield Promise.resolve(e.provideHover(r,t,n));if(i&&isValid(i))return new HoverProviderResult(e,i,o)}catch(i){onUnexpectedExternalError(i)}}))}export function getHover(e,o,r){const t=HoverProviderRegistry.ordered(e),n=t.map(((t,n)=>executeProvider(t,n,e,o,r)));return AsyncIterableObject.fromPromises(n).coalesce()}export function getHoverPromise(e,o,r){return getHover(e,o,r).map((e=>e.hover)).toPromise()}function isValid(e){const o="undefined"!==typeof e.range,r="undefined"!==typeof e.contents&&e.contents&&e.contents.length>0;return o&&r}registerModelAndPositionCommand("_executeHoverProvider",((e,o)=>getHoverPromise(e,o,CancellationToken.None)));