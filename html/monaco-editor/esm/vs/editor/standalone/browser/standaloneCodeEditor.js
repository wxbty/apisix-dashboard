var __decorate=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var d=e.length-1;d>=0;d--)(r=e[d])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},__param=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};import*as aria from"../../../base/browser/ui/aria/aria.js";import{Disposable,toDisposable,DisposableStore}from"../../../base/common/lifecycle.js";import{ICodeEditorService}from"../../browser/services/codeEditorService.js";import{CodeEditorWidget}from"../../browser/widget/codeEditorWidget.js";import{DiffEditorWidget}from"../../browser/widget/diffEditorWidget.js";import{InternalEditorAction}from"../../common/editorAction.js";import{IEditorWorkerService}from"../../common/services/editorWorker.js";import{StandaloneKeybindingService,updateConfigurationService}from"./standaloneServices.js";import{IStandaloneThemeService}from"../common/standaloneTheme.js";import{MenuId,MenuRegistry}from"../../../platform/actions/common/actions.js";import{CommandsRegistry,ICommandService}from"../../../platform/commands/common/commands.js";import{IConfigurationService}from"../../../platform/configuration/common/configuration.js";import{ContextKeyExpr,IContextKeyService}from"../../../platform/contextkey/common/contextkey.js";import{IContextMenuService}from"../../../platform/contextview/browser/contextView.js";import{IInstantiationService}from"../../../platform/instantiation/common/instantiation.js";import{IKeybindingService}from"../../../platform/keybinding/common/keybinding.js";import{INotificationService}from"../../../platform/notification/common/notification.js";import{IThemeService}from"../../../platform/theme/common/themeService.js";import{IAccessibilityService}from"../../../platform/accessibility/common/accessibility.js";import{StandaloneCodeEditorNLS}from"../../common/standaloneStrings.js";import{IClipboardService}from"../../../platform/clipboard/common/clipboardService.js";import{IEditorProgressService}from"../../../platform/progress/common/progress.js";import{IModelService}from"../../common/services/model.js";import{ILanguageService}from"../../common/services/language.js";import{StandaloneCodeEditorService}from"./standaloneCodeEditorService.js";import{PLAINTEXT_LANGUAGE_ID}from"../../common/languages/modesRegistry.js";import{ILanguageConfigurationService}from"../../common/languages/languageConfigurationRegistry.js";let LAST_GENERATED_COMMAND_ID=0,ariaDomNodeCreated=!1;function createAriaDomNode(e){if(!e){if(ariaDomNodeCreated)return;ariaDomNodeCreated=!0}aria.setARIAContainer(e||document.body)}let StandaloneCodeEditor=class extends CodeEditorWidget{constructor(e,t,o,i,r,n,a,d,s,c,m){const l=Object.assign({},t);l.ariaLabel=l.ariaLabel||StandaloneCodeEditorNLS.editorViewAccessibleLabel,l.ariaLabel=l.ariaLabel+";"+StandaloneCodeEditorNLS.accessibilityHelpMessage,super(e,l,{},o,i,r,n,d,s,c,m),this._standaloneKeybindingService=a instanceof StandaloneKeybindingService?a:null,createAriaDomNode(l.ariaContainerElement)}addCommand(e,t,o){if(!this._standaloneKeybindingService)return console.warn("Cannot add command because the editor is configured with an unrecognized KeybindingService"),null;const i="DYNAMIC_"+ ++LAST_GENERATED_COMMAND_ID,r=ContextKeyExpr.deserialize(o);return this._standaloneKeybindingService.addDynamicKeybinding(i,e,t,r),i}createContextKey(e,t){return this._contextKeyService.createKey(e,t)}addAction(e){if("string"!==typeof e.id||"string"!==typeof e.label||"function"!==typeof e.run)throw new Error("Invalid action descriptor, `id`, `label` and `run` are required properties!");if(!this._standaloneKeybindingService)return console.warn("Cannot add keybinding because the editor is configured with an unrecognized KeybindingService"),Disposable.None;const t=e.id,o=e.label,i=ContextKeyExpr.and(ContextKeyExpr.equals("editorId",this.getId()),ContextKeyExpr.deserialize(e.precondition)),r=e.keybindings,n=ContextKeyExpr.and(i,ContextKeyExpr.deserialize(e.keybindingContext)),a=e.contextMenuGroupId||null,d=e.contextMenuOrder||0,s=(t,...o)=>Promise.resolve(e.run(this,...o)),c=new DisposableStore,m=this.getId()+":"+t;if(c.add(CommandsRegistry.registerCommand(m,s)),a){const e={command:{id:m,title:o},when:i,group:a,order:d};c.add(MenuRegistry.appendMenuItem(MenuId.EditorContext,e))}if(Array.isArray(r))for(const p of r)c.add(this._standaloneKeybindingService.addDynamicKeybinding(m,p,s,n));const l=new InternalEditorAction(m,o,o,i,s,this._contextKeyService);return this._actions[t]=l,c.add(toDisposable((()=>{delete this._actions[t]}))),c}_triggerCommand(e,t){if(this._codeEditorService instanceof StandaloneCodeEditorService)try{this._codeEditorService.setActiveCodeEditor(this),super._triggerCommand(e,t)}finally{this._codeEditorService.setActiveCodeEditor(null)}else super._triggerCommand(e,t)}};StandaloneCodeEditor=__decorate([__param(2,IInstantiationService),__param(3,ICodeEditorService),__param(4,ICommandService),__param(5,IContextKeyService),__param(6,IKeybindingService),__param(7,IThemeService),__param(8,INotificationService),__param(9,IAccessibilityService),__param(10,ILanguageConfigurationService)],StandaloneCodeEditor);export{StandaloneCodeEditor};let StandaloneEditor=class extends StandaloneCodeEditor{constructor(e,t,o,i,r,n,a,d,s,c,m,l,p,f){const g=Object.assign({},t);updateConfigurationService(c,g,!1);const u=d.registerEditorContainer(e);"string"===typeof g.theme&&d.setTheme(g.theme),"undefined"!==typeof g.autoDetectHighContrast&&d.setAutoDetectHighContrast(Boolean(g.autoDetectHighContrast));const _=g.model;let S;if(delete g.model,super(e,g,o,i,r,n,a,d,s,m,f),this._configurationService=c,this._standaloneThemeService=d,this._register(u),"undefined"===typeof _){const e=p.getLanguageIdByMimeType(g.language)||g.language||PLAINTEXT_LANGUAGE_ID;S=createTextModel(l,p,g.value||"",e,void 0),this._ownsModel=!0}else S=_,this._ownsModel=!1;if(this._attachModel(S),S){const e={oldModelUrl:null,newModelUrl:S.uri};this._onDidChangeModel.fire(e)}}dispose(){super.dispose()}updateOptions(e){updateConfigurationService(this._configurationService,e,!1),"string"===typeof e.theme&&this._standaloneThemeService.setTheme(e.theme),"undefined"!==typeof e.autoDetectHighContrast&&this._standaloneThemeService.setAutoDetectHighContrast(Boolean(e.autoDetectHighContrast)),super.updateOptions(e)}_postDetachModelCleanup(e){super._postDetachModelCleanup(e),e&&this._ownsModel&&(e.dispose(),this._ownsModel=!1)}};StandaloneEditor=__decorate([__param(2,IInstantiationService),__param(3,ICodeEditorService),__param(4,ICommandService),__param(5,IContextKeyService),__param(6,IKeybindingService),__param(7,IStandaloneThemeService),__param(8,INotificationService),__param(9,IConfigurationService),__param(10,IAccessibilityService),__param(11,IModelService),__param(12,ILanguageService),__param(13,ILanguageConfigurationService)],StandaloneEditor);export{StandaloneEditor};let StandaloneDiffEditor=class extends DiffEditorWidget{constructor(e,t,o,i,r,n,a,d,s,c,m,l){const p=Object.assign({},t);updateConfigurationService(s,p,!0);const f=a.registerEditorContainer(e);"string"===typeof p.theme&&a.setTheme(p.theme),"undefined"!==typeof p.autoDetectHighContrast&&a.setAutoDetectHighContrast(Boolean(p.autoDetectHighContrast)),super(e,p,{},l,r,i,o,n,a,d,c,m),this._configurationService=s,this._standaloneThemeService=a,this._register(f)}dispose(){super.dispose()}updateOptions(e){updateConfigurationService(this._configurationService,e,!0),"string"===typeof e.theme&&this._standaloneThemeService.setTheme(e.theme),"undefined"!==typeof e.autoDetectHighContrast&&this._standaloneThemeService.setAutoDetectHighContrast(Boolean(e.autoDetectHighContrast)),super.updateOptions(e)}_createInnerEditor(e,t,o){return e.createInstance(StandaloneCodeEditor,t,o)}getOriginalEditor(){return super.getOriginalEditor()}getModifiedEditor(){return super.getModifiedEditor()}addCommand(e,t,o){return this.getModifiedEditor().addCommand(e,t,o)}createContextKey(e,t){return this.getModifiedEditor().createContextKey(e,t)}addAction(e){return this.getModifiedEditor().addAction(e)}};StandaloneDiffEditor=__decorate([__param(2,IInstantiationService),__param(3,IContextKeyService),__param(4,IEditorWorkerService),__param(5,ICodeEditorService),__param(6,IStandaloneThemeService),__param(7,INotificationService),__param(8,IConfigurationService),__param(9,IContextMenuService),__param(10,IEditorProgressService),__param(11,IClipboardService)],StandaloneDiffEditor);export{StandaloneDiffEditor};export function createTextModel(e,t,o,i,r){if(o=o||"",!i){const i=o.indexOf("\n");let n=o;return-1!==i&&(n=o.substring(0,i)),doCreateModel(e,o,t.createByFilepathOrFirstLine(r||null,n),r)}return doCreateModel(e,o,t.createById(i),r)}function doCreateModel(e,t,o,i){return e.createModel(t,o,i)}